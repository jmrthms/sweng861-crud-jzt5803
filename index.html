<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SWENG 861 - Week 2</title>
  </head>

  <body>
    <h1>SWENG 861 - Week 2 Deliverable</h1>
    <p>Cloud Image below:</p>
    <!-- REPLACE THE SRC BELOW WITH YOUR ACTUAL CLOUD STORAGE URL -->
    <img
      src="https://storage.googleapis.com/sweng861-image/image.jpg"
      alt="Cloud Hosted Image"
    />

    <div style="margin-top: 20px">
      <h2>Authentication</h2>
      <a
        href="/auth/google"
        style="
          padding: 10px 20px;
          background-color: #4285f4;
          color: white;
          text-decoration: none;
          border-radius: 5px;
        "
        >Login with Google</a
      >

      <div id="user-info" style="margin-top: 20px; display: none">
        <h3>Authenticated!</h3>
        <p>
          Token: <code id="token-display" style="word-break: break-all"></code>
        </p>
        <button onclick="testSecureEndpoint()" style="padding: 5px 10px">
          Test Secure Endpoint
        </button>
        <p id="secure-response"></p>
      </div>
    </div>

    <script>
      // Check for token in URL
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get('token');

      if (token) {
        document.getElementById('user-info').style.display = 'block';
        document.getElementById('token-display').textContent = token;
        // Clear token from URL to be clean
        window.history.replaceState({}, document.title, '/');
        localStorage.setItem('jwt', token);
      } else if (localStorage.getItem('jwt')) {
        document.getElementById('user-info').style.display = 'block';
        document.getElementById('token-display').textContent =
          localStorage.getItem('jwt');
      }

      async function testSecureEndpoint() {
        const token = localStorage.getItem('jwt');
        try {
          const res = await fetch('/secure-data', {
            headers: { Authorization: `Bearer ${token}` },
          });
          if (res.ok) {
            const data = await res.json();
            document.getElementById('secure-response').textContent =
              'Success: ' + JSON.stringify(data);
            document.getElementById('secure-response').style.color = 'green';
          } else {
            document.getElementById('secure-response').textContent =
              'Error: ' + res.status;
            document.getElementById('secure-response').style.color = 'red';
          }
        } catch (e) {
          document.getElementById('secure-response').textContent =
            'Error: ' + e.message;
        }
      }
    </script>
  </body>
</html>
